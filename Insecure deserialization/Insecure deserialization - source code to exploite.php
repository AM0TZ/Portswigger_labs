<!-- /libs/CustomTemplate.php -->

<?php

class CustomTemplate {              
    private $template_file_path;   
    private $lock_file_path;        

    public function __construct($template_file_path) {  //magic method - 1st infection point
        $this->template_file_path = $template_file_path; // assign $tfp to CT class' property $tfp
        $this->lock_file_path = $template_file_path . ".lock"; //assign  $tfp.lock to CT class' property $lfp
    }

    private function isTemplateLocked() {
        return file_exists($this->lock_file_path);
    }

    public function getTemplate() {
        return file_get_contents($this->template_file_path);
    }

    public function saveTemplate($template) {
        if (!isTemplateLocked()) {
            if (file_put_contents($this->lock_file_path, "") === false) {
                throw new Exception("Could not write to " . $this->lock_file_path);
            }
            if (file_put_contents($this->template_file_path, $template) === false) {
                throw new Exception("Could not write to " . $this->template_file_path);
            }
        }
    }

    function __destruct() {  //magic method - 1st infection point
        // Carlos thought this would be a good idea (original remark- a clue or red hering)
        if (file_exists($this->lock_file_path)) {    //checks if file exists in $lfp
            unlink($this->lock_file_path);       //call unlink() with $lfp as parameter. apperantly unlink=delete file
        }
    }
}

?>

//class = class
// methods (=functions)
// properties (=variables)
//private = variable cant be access outside the class